<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>InfinityGoogleplex Location Universe</title>
<style>
  /* Basic reset and layout */
  body, html {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: radial-gradient(ellipse at center, #000000 0%, #0d0d0d 100%);
    color: #eee;
  }
  #app {
    position: relative;
    width: 100vw; height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center;
    padding: 10px;
    backdrop-filter: blur(10px);
    background: rgba(0,0,0,0.6);
  }
  h1 {
    font-weight: 900; font-size: 2.4rem; letter-spacing: 2px;
    margin-bottom: 0.3em;
    text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
  }
  #location-info {
    margin-top: 0.5em;
    background: #111;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 15px #0ff;
    max-width: 400px;
    user-select: none;
  }
  .coords {
    font-size: 1.2rem;
    margin: 5px 0;
  }
  #buttons {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }
  button.share-btn {
    background: #0ff;
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    font-weight: 700;
    color: #000;
    cursor: pointer;
    box-shadow: 0 0 15px #0ff;
    transition: background 0.3s ease;
    flex: 1 1 120px;
  }
  button.share-btn:hover {
    background: #00cccc;
  }
  #map {
    width: 90vw;
    max-width: 600px;
    height: 300px;
    margin-top: 20px;
    border-radius: 15px;
    box-shadow: 0 0 25px #0ff;
  }
  #globe {
    margin-top: 30px;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    box-shadow: 0 0 30px #0ff;
  }
  #qr-code {
    margin-top: 20px;
  }
  #desc, #hash, #status, #countdown {
    margin-top: 15px;
    font-size: 1rem;
    max-width: 400px;
    word-wrap: break-word;
    user-select: all;
  }
  #dev-panel {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.85);
    color: #0ff;
    font-family: monospace;
    font-size: 0.85rem;
    padding: 15px;
    border-radius: 12px;
    max-width: 350px;
    max-height: 70vh;
    overflow-y: auto;
    box-shadow: 0 0 25px #0ff;
  }
</style>
</head>
<body>
<div id="app">
  <h1>InfinityGoogleplex Location Universe</h1>
  <div id="location-info">
    <div class="coords" id="lat">Latitude: --</div>
    <div class="coords" id="lon">Longitude: --</div>
    <div class="coords" id="elev">Elevation: -- meters</div>
    <div id="desc">Loading AI-generated location description...</div>
    <div id="hash">SHA-256 Hash: --</div>
    <div id="countdown">Link expires in: --</div>
  </div>

  <div id="buttons">
    <button class="share-btn" id="whatsapp-btn" title="Share via WhatsApp">WhatsApp</button>
    <button class="share-btn" id="sms-btn" title="Share via SMS">SMS</button>
    <button class="share-btn" id="email-btn" title="Share via Email">Email</button>
    <button class="share-btn" id="telegram-btn" title="Share via Telegram">Telegram</button>
  </div>

  <div id="map"></div>
  <canvas id="globe"></canvas>
  <div id="qr-code"></div>

  <div id="status">Status: Initializing...</div>
</div>

<div id="dev-panel" hidden>
  <strong>Developer Panel (Telemetry & Raw Data):</strong><br />
  <pre id="dev-log">Waiting for data...</pre>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
(() => {
  const latElem = document.getElementById('lat');
  const lonElem = document.getElementById('lon');
  const elevElem = document.getElementById('elev');
  const descElem = document.getElementById('desc');
  const hashElem = document.getElementById('hash');
  const statusElem = document.getElementById('status');
  const countdownElem = document.getElementById('countdown');
  const devPanel = document.getElementById('dev-panel');
  const devLog = document.getElementById('dev-log');
  const qrCodeContainer = document.getElementById('qr-code');

  let lat = null;
  let lon = null;
  let elevation = null;
  let address = null;
  let aiDescription = null;
  let hashValue = null;
  let expirationTime = Date.now() + 10 * 60 * 1000; // Link expires in 10 mins
  let password = ''; // can implement password logic later

  let map;
  let marker;

  // Initialize map
  function initMap(lat, lon) {
    if (!map) {
      map = L.map('map').setView([lat, lon], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 18,
      }).addTo(map);
      marker = L.marker([lat, lon]).addTo(map);
    } else {
      map.setView([lat, lon], 13);
      marker.setLatLng([lat, lon]);
    }
  }

  // SHA-256 hash function
  function sha256(str) {
    return CryptoJS.SHA256(str).toString(CryptoJS.enc.Hex);
  }

  // Fetch elevation using Open-Elevation API
  async function fetchElevation(lat, lon) {
    try {
      const res = await fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${lat},${lon}`);
      const data = await res.json();
      return data.results[0].elevation;
    } catch (e) {
      return null;
    }
  }

  // Reverse geocode using OpenStreetMap Nominatim
  async function reverseGeocode(lat, lon) {
    try {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      return data.display_name;
    } catch (e) {
      return null;
    }
  }

  // Generate AI description placeholder (You can replace this with a real AI API call)
  async function generateAiDescription(address) {
    return `You are currently near: ${address}`;
  }

  // Generate QR code for sharing URL
  function generateQRCode(url) {
    qrCodeContainer.innerHTML = '';
    new QRCode(qrCodeContainer, {
      text: url,
      width: 150,
      height: 150,
      colorDark: '#0ff',
      colorLight: '#000',
      correctLevel: QRCode.CorrectLevel.H
    });
  }

  // Update countdown timer
  function startCountdown() {
    function update() {
      let now = Date.now();
      let diff = expirationTime - now;
      if (diff <= 0) {
        countdownElem.textContent = 'Link expired.';
        statusElem.textContent = 'Status: Link expired.';
        // Optionally disable sharing buttons here
        disableSharingButtons(true);
      } else {
        let mins = Math.floor(diff / 60000);
        let secs = Math.floor((diff % 60000) / 1000);
        countdownElem.textContent = `Link expires in: ${mins}m ${secs}s`;
      }
    }
    update();
    return setInterval(update, 1000);
  }

  // Disable/enable sharing buttons
  function disableSharingButtons(disable) {
    document.querySelectorAll('button.share-btn').forEach(btn => {
      btn.disabled = disable;
      btn.style.opacity = disable ? '0.5' : '1';
      btn.style.cursor = disable ? 'default' : 'pointer';
    });
  }

  // Compose shareable message with location info and hash
  function composeMessage() {
    return `ðŸš€ My current location: ${address}\n
Latitude: ${lat}\nLongitude: ${lon}\nElevation: ${elevation}m\n
SHA-256 Signature: ${hashValue}\n
Link expires in 10 minutes.\n
Check out my location universe!`;
  }

  // Share handlers for each platform
  function shareWhatsApp() {
    const message = encodeURIComponent(composeMessage());
    const url = `https://wa.me/?text=${message}`;
    window.open(url, '_blank');
  }
  function shareSMS() {
    const message = encodeURIComponent(composeMessage());
    const url = `sms:?&body=${message}`;
    window.open(url);
  }
  function shareEmail() {
    const subject = encodeURIComponent('My Location Universe ðŸŒŒ');
    const body = encodeURIComponent(composeMessage());
    const url = `mailto:?subject=${subject}&body=${body}`;
    window.open(url);
  }
  function shareTelegram() {
    const message = encodeURIComponent(composeMessage());
    const url = `https://t.me/share/url?url=&text=${message}`;
    window.open(url, '_blank');
  }

  // Voice-over the AI description
  function speakDescription(text) {
    if (!('speechSynthesis' in window)) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utterance);
  }

  // Animate globe canvas (simple rotating Earth)
  function animateGlobe() {
    const canvas = document.getElementById('globe');
    const ctx = canvas.getContext('2d');
    canvas.width = 200;
    canvas.height = 200;

    const earth = new Image();
    earth.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Earth_equirectangular_projection_SW.jpg/320px-Earth_equirectangular_projection_SW.jpg';

    let rotation = 0;

    earth.onload = () => {
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2, canvas.height/2);
        ctx.rotate(rotation);
        ctx.drawImage(earth, -canvas.width/2, -canvas.height/2, canvas.width, canvas.height);
        ctx.restore();
        rotation += 0.002;
        requestAnimationFrame(draw);
      }
      draw();
    }
  }

  // Developer panel toggle on Ctrl+D
  document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.key.toLowerCase() === 'd') {
      devPanel.hidden = !devPanel.hidden;
    }
  });

  // Main function to get geolocation and update UI
  async function updateLocation() {
    if (!navigator.geolocation) {
      statusElem.textContent = 'Geolocation is not supported by your browser.';
      return;
    }
    statusElem.textContent = 'Obtaining location...';

    navigator.geolocation.getCurrentPosition(async (position) => {
      lat = position.coords.latitude.toFixed(6);
      lon = position.coords.longitude.toFixed(6);
      elevElem.textContent = 'Elevation: fetching...';
      latElem.textContent = `Latitude: ${lat}`;
      lonElem.textContent = `Longitude: ${lon}`;

      elevation = await fetchElevation(lat, lon);
      elevElem.textContent = `Elevation: ${elevation !== null ? elevation + ' m' : 'Unavailable'}`;

      address = await reverseGeocode(lat, lon) || 'Unknown location';
      descElem.textContent = 'Generating AI description...';

      aiDescription = await generateAiDescription(address);
      descElem.textContent = aiDescription;

      // Speak the description once loaded
      speakDescription(aiDescription);

      const rawDataString = `${lat},${lon},${elevation},${address}`;
      hashValue = sha256(rawDataString);
      hashElem.textContent = `SHA-256 Hash: ${hashValue}`;

      // Initialize or update map
      initMap(lat, lon);

      // Generate shareable URL for QR code (you can replace base URL with your own)
      const shareURL = `${window.location.origin}${window.location.pathname}?lat=${lat}&lon=${lon}&elev=${elevation}&hash=${hashValue}`;
      generateQRCode(shareURL);

      statusElem.textContent = 'Location updated successfully.';
      devLog.textContent = JSON.stringify({
        latitude: lat,
        longitude: lon,
        elevation,
        address,
        aiDescription,
        hashValue,
        shareURL,
        timestamp: new Date().toISOString(),
      }, null, 2);
    }, (error) => {
      statusElem.textContent = `Error obtaining location: ${error.message}`;
    }, {
      enableHighAccuracy: true,
      timeout: 15000,
      maximumAge: 0,
    });
  }

  // Initialize globe animation
  animateGlobe();

  // Set up sharing buttons
  document.getElementById('whatsapp-btn').onclick = shareWhatsApp;
  document.getElementById('sms-btn').onclick = shareSMS;
  document.getElementById('email-btn').onclick = shareEmail;
  document.getElementById('telegram-btn').onclick = shareTelegram;

  // Start countdown
  startCountdown();

  // Kick off first location update
  updateLocation();

  // Optionally, auto-update location every 60 seconds
  setInterval(updateLocation, 60000);

})();
</script>
</body>
</html>
